
var canvas;
var gl;


var points = [];
var colors = [];

var NumVertices = 0;

var heatmap = [[0.1496627,0.0341484,0.03077572,0.02698145,0.04890388,0.03731029,0.03625632,0.028457,0.02129005,0.03182968,0.02824621,0.03035413,0.02613828,0.03056492,0.0255059,0.02698145,0.0257167,0.03478078,0.03920742,0.02592749,0.01918213,0.01918213,0.0198145,0.02023609,0.02129005,0.01496627,0.01285835,0.01370152,0.0170742,0.01812816,0.02255481,0.009274874,0.0113828,0.009696458,0.01791737,0.01370152],
[0.1587605,0.01472839,0.01472839,0.02811783,0.03844682,0.0472456,0.02390972,0.02505738,0.02524866,0.03423871,0.02295333,0.0120505,0.02945677,0.03902066,0.01224178,0.01166794,0.02084927,0.01185922,0.01147666,0.0189365,0.02983933,0.04361133,0.0334736,0.03921194,0.02773527,0.01798011,0.01778883,0.01568477,0.0420811,0.01166794,0.01090283,0.03404744,0.008224943,0.02008416,0.006120888,0.04055088],
[0.1977778,0.04194444,0.03277778,0.04694445,0.05916667,0.06194445,0.04611111,0.02833333,0.04277778,0.03,0.02888889,0.02944444,0.02361111,0.01916667,0.01694445,0.01361111,0.01527778,0.02027778,0.01444444,0.01611111,0.01444444,0.01166667,0.01222222,0.01166667,0.01611111,0.01861111,0.02388889,0.01722222,0.004722222,0.004444445,0.004722222,0.006944444,0.007222222,0.01361111,0.005555556,0.04138889],
[0.2176856,0.03511741,0.01903956,0.01819336,0.02094352,0.02877089,0.03363656,0.02517453,0.02390523,0.02284747,0.02073197,0.02221282,0.03384811,0.03934842,0.02284747,0.01734716,0.01861646,0.01480855,0.02665538,0.02453988,0.02369368,0.02136662,0.01882801,0.0300402,0.02602073,0.01565475,0.01650095,0.02052042,0.02750159,0.0325788,0.02052042,0.02305902,0.0167125,0.006981172,0.006769621,0.006981172],
[0.2436459,0.02594216,0.01717791,0.0173532,0.01787905,0.05714285,0.02979842,0.01770377,0.03908852,0.0312007,0.02366345,0.02348817,0.02261174,0.02103418,0.01209465,0.01682734,0.02681858,0.01051709,0.01787905,0.02296231,0.0312007,0.01630149,0.02226117,0.01595092,0.027695,0.01332165,0.01297108,0.01279579,0.01349693,0.02226117,0.03733567,0.01577564,0.01051709,0.008764242,0.02751972,0.01700263],
[0.2576806,0.1101578,0.104899,0.1029615,0.09244395,0.04123997,0.0332134,0.03349017,0.0332134,0.03265984,0.03238306,0.02684749,0.02158871,0.01716026,0.00968724,0.009964019,0.009964019,0.00968724,0.009410462,0.00968724,0.00166067,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.2742405,0.01341306,0.01341306,0.01357466,0.04411765,0.04912734,0.02811894,0.01325145,0.05349063,0.01389787,0.02569489,0.0156755,0.04541047,0.01470588,0.007918552,0.01955398,0.02213963,0.009696187,0.005494506,0.01405947,0.02957337,0.01712993,0.02149321,0.01616031,0.03555268,0.01308985,0.01325145,0.01389787,0.01325145,0.0413704,0.04282482,0.01341306,0.005494506,0.0158371,0.005332903,0.005332903],
[0.2837234,0.02051012,0.1051801,0.07178544,0.07967395,0.01577702,0.02471733,0.01682882,0.02734683,0.03102814,0.01288457,0.02156193,0.01446227,0.008940311,0.008940311,0.00841441,0.01525112,0.01341047,0.01367342,0.01156981,0.008677361,0.009466211,0.01314752,0.01104391,0.004470156,0.007888509,0.009203261,0.006836708,0.006573758,0.009203261,0.005259006,0.01209571,0.004996056,0.05443072,0.01209571,0.01893242],
[0.297901,0.02018299,0.02960172,0.06889128,0.02099031,0.0204521,0.03928956,0.04413348,0.02341227,0.01829925,0.02960172,0.03417653,0.01937567,0.03229279,0.03498385,0.01803014,0.01776103,0.02099031,0.01345533,0.0204521,0.0204521,0.03444564,0.02287406,0.01184069,0.00861141,0.02637244,0.006727664,0.006458557,0.004574812,0.004305705,0.005113025,0.004843918,0.002421959,0.0121098,0.002421959,0.002152852],
[0.3194259,0.02436582,0.02269693,0.02236315,0.02503338,0.04238985,0.04105474,0.03304406,0.02837116,0.03738318,0.03604807,0.05373832,0.0370494,0.02503338,0.02303071,0.01134847,0.01068091,0.02069426,0.01134847,0.01101469,0.01101469,0.01134847,0.02970628,0.01301736,0.008678238,0.01168224,0.01368491,0.01401869,0.01602136,0.01168224,0.01034713,0.006008011,0.006675567,0,0,0],
[0.3283491,0.02807446,0.0341776,0.02898993,0.06866036,0.02715899,0.07873055,0.02288679,0.02227647,0.0469942,0.03143119,0.03082087,0.009765029,0.01586817,0.01800427,0.005187672,0.002441257,0.002441257,0.002441257,0.002746414,0.002441257,0.002441257,0.01007019,0.01037534,0.009765029,0.009765029,0.0106805,0.02105584,0.02410742,0.01464754,0.0085444,0.01525786,0.01647849,0.007323772,0.01037534,0.0192249],
[0.3629793,0.02891263,0.02105594,0.02608422,0.04179761,0.03582652,0.02891263,0.02074167,0.03676933,0.02639849,0.0282841,0.09176619,0.02891263,0.01099937,0.008170961,0.01979887,0.00848523,0.02199874,0.009428033,0.002514142,0.007228158,0.007856694,0.008170961,0.01005657,0.01351351,0.01414205,0.008170961,0.00848523,0.01759899,0.005971088,0.007542426,0.005028284,0.005028284,0.00565682,0.005028284,0.0106851],
[0.4979123,0.02583507,0.02531315,0.02583507,0.02531315,0.02583507,0.02531315,0.02583507,0.02609603,0.02583507,0.02583507,0.02531315,0.02557411,0.02009395,0.01748434,0.01722338,0.01670146,0.01696242,0.01539666,0.009133612,0.008872651,0.009133612,0.009133612,0.008872651,0.008872651,0.009133612,0.009133612,0.008872651,0.009133612,0,0,0,0,0,0,0],
[0.7095801,0.01030928,0.002011566,0.1123963,0.002011566,0.002263012,0.002011566,0.002011566,0.002011566,0.002263012,0.002011566,0.002011566,0.002263012,0.002011566,0.01131506,0,0,0,0,0,0,0,0,0.001508675,0.009303494,0.06110133,0.01257229,0.004526025,0.004023133,0.004023133,0.004023133,0.004526025,0.004023133,0.004023133,0.01508675,0.00477747],
[0.09397163,0.02442868,0.04491726,0.03368794,0.0428487,0.03289992,0.02728526,0.05289598,0.02423168,0.0214736,0.02423168,0.02039007,0.02019306,0.01891253,0.07535461,0.01635146,0.02462569,0.04373522,0.03339244,0.04540977,0.01654846,0.02167061,0.02610323,0.01310087,0.02226162,0.01802601,0.0106383,0.009456265,0.01221434,0.04225768,0.0215721,0.02206462,0.009751773,0.01024429,0.01871552,0.004137116],
[0.1293067,0.01091734,0.01077556,0.01105912,0.02183468,0.01148447,0.06351907,0.06125053,0.02126754,0.03303559,0.01658868,0.01970793,0.02240181,0.03544591,0.02112576,0.008507018,0.01942436,0.01758117,0.04352757,0.06224301,0.03090883,0.02226003,0.02537927,0.05217637,0.01587977,0.01857366,0.01247696,0.01247696,0.01587977,0.01970793,0.05430313,0.01545442,0.01219339,0.03615483,0.009783071,0.005387778],
[0.1476629,0.02230878,0.01062323,0.03594192,0.0115085,0.01257082,0.04992918,0.05116855,0.02584986,0.04514872,0.02106941,0.04992918,0.0253187,0.04922096,0.01115439,0.05063739,0.01540368,0.004957507,0.005311615,0.01469547,0.0115085,0.04815864,0.03293201,0.04426346,0.02283994,0.007613314,0.007967422,0.01097734,0.01504957,0.03399433,0.01115439,0.02124646,0.005488669,0.01558074,0.02036119,0.03045326],
[0.1491281,0.009771497,0.01924233,0.03457607,0.04344558,0.0503608,0.02856284,0.03728202,0.03968731,0.01262778,0.02345159,0.02044498,0.0132291,0.02871317,0.01743837,0.01488274,0.006464222,0.02254961,0.04930848,0.0347264,0.04750451,0.02435358,0.02871317,0.04509922,0.0112748,0.009921828,0.008869513,0.01277811,0.01142514,0.03156945,0.04660252,0.009470836,0.01473241,0.03141912,0.005411906,0.004960914],
[0.1494594,0.009115963,0.008691966,0.009115963,0.0515158,0.04663981,0.06275175,0.03116388,0.01377994,0.01271995,0.01335595,0.06593174,0.01568794,0.05469578,0.01717193,0.007843968,0.0493958,0.002967988,0.01483994,0.01717193,0.006995972,0.03391986,0.0252279,0.01165995,0.03052788,0.02755989,0.0254399,0.01462794,0.01992792,0.03964384,0.06063176,0.01695993,0.006359975,0.004663981,0.004663981,0.01717193],
[0.1506849,0.04710992,0.05579686,0.01653859,0.04226528,0.03558303,0.009856331,0.02104911,0.005846976,0.01787504,0.0180421,0.01954561,0.01937855,0.02322085,0.006181089,0.01703976,0.0322419,0.02271968,0.04276646,0.008686936,0.03541597,0.01386569,0.01737387,0.02004678,0.007016371,0.01854327,0.02639492,0.008018711,0.009188105,0.03307718,0.04594053,0.02906783,0.04894755,0.02439024,0.01085867,0.03942532],
[0.1581172,0.01530166,0.01530166,0.03788983,0.01471874,0.08379482,0.01457301,0.02579423,0.04036724,0.02360828,0.01311571,0.01282425,0.04342757,0.02244244,0.02783445,0.01034684,0.003060332,0.003206062,0.01326144,0.03395512,0.05187992,0.02739726,0.03104051,0.03074905,0.02681434,0.0164675,0.01617604,0.01573885,0.01544739,0.02535704,0.0483824,0.02623142,0.006266395,0.02550277,0.006849315,0.01675896],
[0.1595642,0.01765274,0.02206592,0.02123845,0.0310302,0.04868294,0.03351262,0.03047855,0.02537581,0.04275272,0.04109778,0.02896152,0.04330437,0.01186043,0.03006482,0.02247966,0.007309336,0.02951317,0.02454834,0.02330713,0.01820439,0.0241346,0.03309888,0.03806371,0.02606537,0.01103296,0.01186043,0.01558406,0.01613571,0.02468625,0.04192525,0.005102744,0.00482692,0.01448076,0.01682526,0.003171976],
[0.1641097,0.01828607,0.008833101,0.008988068,0.01782117,0.03827677,0.07422904,0.0483496,0.0120874,0.05051914,0.0353324,0.0079033,0.01472183,0.02866884,0.02169533,0.005578801,0.0376569,0.004029134,0.0339377,0.04432047,0.0237099,0.02665427,0.03006354,0.02634433,0.0130172,0.009607934,0.02309003,0.01177747,0.0106927,0.018596,0.0292887,0.04308074,0.02866884,0.0041841,0.023245,0.002634434],
[0.1661097,0.01448065,0.01294904,0.01336675,0.1157059,0.04427736,0.0139237,0.04093567,0.01211362,0.04037873,0.01364523,0.04023949,0.00877193,0.01531607,0.03077137,0.005987191,0.02756892,0.02018936,0.02422724,0.008493456,0.06544138,0.02269563,0.03494848,0.0229741,0.01072125,0.01642996,0.009468115,0.01559454,0.01726539,0.06112504,0.002923977,0.0139237,0.003341688,0.01503759,0.005291006,0.01336675],
[0.1694182,0.01166143,0.01087526,0.0129717,0.04127358,0.03183962,0.06132075,0.0250262,0.02699161,0.02672956,0.02253669,0.03616352,0.02777778,0.04310796,0.007730608,0.007599581,0.03498428,0.004848008,0.02201258,0.05490042,0.01650943,0.02777778,0.02044025,0.03642558,0.02279874,0.01899895,0.01218553,0.01231656,0.01231656,0.03904612,0.0172956,0.0322327,0.01912998,0.01362683,0.008385744,0.01074423],
[0.1871861,0.01194805,0.01004329,0.01021645,0.01818182,0.03186147,0.07290043,0.0374026,0.03238095,0.05523809,0.007619048,0.007445887,0.03549783,0.01939394,0.007445887,0.008658009,0.04692641,0.006233766,0.005194805,0.01454545,0.07740259,0.01212121,0.02008658,0.02199134,0.03601731,0.02891775,0.007619048,0.007965367,0.008311688,0.008311688,0.05004329,0.03757576,0.01835498,0.003636363,0.01852814,0.01679654],
[0.1915631,0.008762992,0.008966782,0.008355411,0.06032199,0.06765845,0.05176279,0.02873446,0.051559,0.02934583,0.0256776,0.007132668,0.00794783,0.06154473,0.008355411,0.004890972,0.03240269,0.001018953,0.01732219,0.01487671,0.03342164,0.01834115,0.01732219,0.03199511,0.006521296,0.02771551,0.005502344,0.01324638,0.0128388,0.008559201,0.08151621,0.01100469,0.003668229,0.004483391,0.03117995,0.004483391],
[0.1952762,0.04976803,0.01068466,0.00955996,0.03500633,0.03950513,0.04344159,0.03317869,0.04414452,0.02432166,0.02811753,0.02657107,0.01293406,0.05932799,0.01813581,0.008154084,0.01743287,0.01644875,0.01110642,0.03950513,0.007029383,0.04414452,0.01982286,0.01518347,0.01433994,0.005201743,0.008857022,0.01068466,0.02108815,0.01687052,0.03275692,0.03036693,0.01757346,0.02713342,0.003514691,0.002811753]];


var jet = [{"index":0,"rgb":
	[0,0,131
	]},{"index":0.125,"rgb":
	[0,60,170
	]},{"index":0.375,"rgb":
	[5,255,255
	]},{"index":0.625,"rgb":
	[255,255,0
	]},{"index":0.875,"rgb":
	[250,0,0
	]},{"index":1,"rgb":
	[128,0,0
	]}];

var sqrtValue = 0;
var CreateCircle = function (offset, id, numFacets, innerRadius, outerRadius) {
	var deltaAngle = 2 * Math.PI / numFacets;
	for (var i = 0; i < numFacets; i++) {
		var vertices = [];
		vertices.push(vec4(offset[0] + Math.sin(deltaAngle * (i - 0.5)) * innerRadius, offset[1] + Math.cos(deltaAngle * (i - 0.5)) * innerRadius, 0, 1));
		vertices.push(vec4(offset[0] + Math.sin(deltaAngle * (i + 0.5)) * innerRadius, offset[1] + Math.cos(deltaAngle * (i + 0.5)) * innerRadius, 0, 1));
		vertices.push(vec4(offset[0] + Math.sin(deltaAngle * (i - 0.5)) * outerRadius, offset[1] + Math.cos(deltaAngle * (i - 0.5)) * outerRadius, 0, 1));
		vertices.push(vec4(offset[0] + Math.sin(deltaAngle * (i + 0.5)) * outerRadius, offset[1] + Math.cos(deltaAngle * (i + 0.5)) * outerRadius, 0, 1));
		var color = vec4(1, 1, 0, 1);
		//for (var j = 0; j < jet.length - 1; j++) {
		//	if (jet[j].index <= heatmap[id][i] && heatmap[id][i] < jet[j+1].index) {
				//color[0] = (1 - (heatmap[id][i] - jet[j].index)) * ( jet[j].rgb[0] * 1.0 / 255) * (1 - (jet[j+1].index - heatmap[id][i])) * (jet[j+1].rgb[0] * 1.0 / 255);
				//color[1] = (1 - (heatmap[id][i] - jet[j].index)) * ( jet[j].rgb[1] * 1.0 / 255) * (1 - (jet[j+1].index - heatmap[id][i])) * (jet[j+1].rgb[1] * 1.0 / 255);
				//color[2] = (1 - (heatmap[id][i] - jet[j].index)) * ( jet[j].rgb[2] * 1.0 / 255) * (1 - (jet[j+1].index - heatmap[id][i])) * (jet[j+1].rgb[2] * 1.0 / 255);
								
		//		break;
		//	}
		//}
		if (sqrtValue == 0) {		
			color[1] = (1 - heatmap[id][i]);
		}
		else {
			color[1] = (1 - Math.sqrt(heatmap[id][i]));
		}
		points.push(vertices[0]);
		colors.push(color);
		points.push(vertices[1]);
		colors.push(color);
		points.push(vertices[3]);        
		colors.push(color);
		points.push(vertices[0]);        
		colors.push(color);
		points.push(vertices[3]);        
		colors.push(color);
		points.push(vertices[2]);        
		colors.push(color);
		NumVertices += 6;
	}
}

window.onload = function init()
{
    canvas = document.getElementById( "gl-canvas" );
    
    gl = WebGLUtils.setupWebGL( canvas );
    if ( !gl ) { alert( "WebGL isn't available" ); }

    gl.viewport( 0, 0, canvas.width, canvas.height );
    gl.clearColor( 1.0, 1.0, 1.0, 1.0 );
    
    gl.enable(gl.DEPTH_TEST);

	for (var i = 0; i < 28; i++) {
		var r = Math.floor(i / 7);
		var c = i % 7;
		var offset = vec2((c - 3) * 0.3, (1.5 - r) * 0.3);
		CreateCircle (offset, i, 36, 0.08, 0.1);
	}
	
    //
    //  Load shaders and initialize attribute buffers
    //
    var program = initShaders( gl, "vertex-shader", "fragment-shader" );
    gl.useProgram( program );
    
    var cBuffer = gl.createBuffer();
    gl.bindBuffer( gl.ARRAY_BUFFER, cBuffer );
    gl.bufferData( gl.ARRAY_BUFFER, flatten(colors), gl.STATIC_DRAW );

    var vColor = gl.getAttribLocation( program, "vColor" );
    gl.vertexAttribPointer( vColor, 4, gl.FLOAT, false, 0, 0 );
    gl.enableVertexAttribArray( vColor );

    var vBuffer = gl.createBuffer();
    gl.bindBuffer( gl.ARRAY_BUFFER, vBuffer );
    gl.bufferData( gl.ARRAY_BUFFER, flatten(points), gl.STATIC_DRAW );
    

    var vPosition = gl.getAttribLocation( program, "vPosition" );
    gl.vertexAttribPointer( vPosition, 4, gl.FLOAT, false, 0, 0 );
    gl.enableVertexAttribArray( vPosition );

    thetaLoc = gl.getUniformLocation(program, "theta"); 
        
    render();
}

function render()
{
    gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

    gl.drawArrays( gl.TRIANGLES, 0, NumVertices );

    requestAnimFrame( render );
}

